<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Quiz Siswa - Firebase</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-xl p-6">
    <h1 class="text-xl font-bold text-center mb-4">Quiz Siswa</h1>

    <!-- Tempat soal -->
    <div id="quiz" class="space-y-4"></div>

    <!-- Navigasi soal -->
    <div class="flex justify-between mt-6">
      <button id="prevBtn" class="bg-gray-400 text-white px-4 py-2 rounded-lg" disabled>‚Üê Sebelumnya</button>
      <button id="nextBtn" class="bg-teal-600 text-white px-4 py-2 rounded-lg">Selanjutnya ‚Üí</button>
    </div>

    <!-- Logout -->
    <button id="logoutBtn" class="mt-4 w-full bg-red-500 text-white p-2 rounded-lg">Logout</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAJ5I8k2MzAyDLt9fUcXHRNtRVjKB_ETLY",
      authDomain: "projectid-81104.firebaseapp.com",
      projectId: "projectid-81104",
      storageBucket: "projectid-81104.firebasestorage.app",
      messagingSenderId: "554913260457",
      appId: "1:554913260457:web:bf988867ebfd902c651ab8",
      measurementId: "G-8WFHQW5WGN"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();

    const quizEl = document.getElementById("quiz");
    const nextBtn = document.getElementById("nextBtn");
    const prevBtn = document.getElementById("prevBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    let soalList = [];
    let currentIndex = 0;

    // üîπ Logout
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });

    // üîπ Cek login
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
      } else {
        loadSoal();
      }
    });

    // üîπ Ambil soal dari Firestore
    async function loadSoal() {
      try {
        const snapshot = await getDocs(collection(db, "soal"));
        soalList = snapshot.docs.map(doc => doc.data());
        if (soalList.length === 0) {
          quizEl.innerHTML = "<p class='text-center text-gray-500'>Belum ada soal.</p>";
        } else {
          renderSoal();
        }
      } catch (err) {
        console.error("Error load soal:", err);
        quizEl.innerHTML = "<p class='text-center text-red-500'>Gagal mengambil soal. Cek rules Firestore & login user.</p>";
      }
    }

    // üîπ Tampilkan soal
    function renderSoal() {
      const data = soalList[currentIndex];
      quizEl.innerHTML = `
        <div class="p-4 bg-gray-50 rounded-lg shadow">
          <h2 class="font-semibold mb-3">Soal ${currentIndex + 1}:</h2>
          <p class="mb-4">${data.pertanyaan}</p>
          <div class="space-y-2">
            ${["A","B","C","D"].map(opt => `
              <div class="option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                   data-correct="${opt === data.jawaban}">
                ${data.opsi[opt]} 
              </div>
            `).join("")}
          </div>
          <p id="feedback" class="mt-4 font-semibold hidden"></p>
        </div>
      `;

      document.querySelectorAll(".option").forEach(optEl => {
        optEl.addEventListener("click", () => {
          const benar = optEl.dataset.correct === "true";
          const feedback = document.getElementById("feedback");
          feedback.classList.remove("hidden");
          if (benar) {
            optEl.classList.add("bg-green-300");
            feedback.textContent = "‚úÖ Benar! " + (data.penjelasan || "");
            feedback.className = "mt-4 font-semibold text-green-600";
          } else {
            optEl.classList.add("bg-red-300");
            feedback.textContent = "‚ùå Salah. " + (data.penjelasan || "");
            feedback.className = "mt-4 font-semibold text-red-600";
          }
          document.querySelectorAll(".option").forEach(o => o.style.pointerEvents = "none");
        });
      });

      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === soalList.length - 1;
    }

    // üîπ Navigasi soal
    nextBtn.addEventListener("click", () => {
      if (currentIndex < soalList.length - 1) {
        currentIndex++;
        renderSoal();
      }
    });

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) {
        currentIndex--;
        renderSoal();
      }
    });
  </script>
</body>
</html>
