<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANTARA - Luxmeter dengan Simulasi Parabola</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #38b2ac;
            --secondary: #0e7490;
            --accent: #f59e0b;
        }
        
        body {
            font-family: 'Baloo 2', cursive;
            background-color: #f8fafc;
        }
        
        .app-container {
            max-width: 414px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* NAVBAR */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 414px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            background: white;
            z-index: 10;
            height: 70px;
            display: flex;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            text-decoration: none;
            flex: 1;
            height: 100%;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
        }
        
        .nav-item span {
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-icon {
            transition: all 0.3s ease;
            font-size: 1.25rem;
        }
        
        .nav-icon.active {
            transform: translateY(-5px);
            color: var(--primary);
        }
        
        /* Video Container */
        .video-container {
            position: relative;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            height: 300px;
        }
        
        #video-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Canvas untuk analisis */
        .analysis-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            pointer-events: none;
        }
        
        /* Chart Container */
        .chart-container {
            height: 280px;
            position: relative;
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .parabola-chart-container {
            height: 300px;
            position: relative;
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        /* Empty Chart State */
        .empty-chart {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #9ca3af;
            text-align: center;
        }
        
        .empty-chart-icon {
            font-size: 48px;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        .empty-chart-text {
            font-size: 12px;
            max-width: 200px;
        }
        
        /* Chart Controls */
        .chart-controls {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .chart-btn {
            padding: 4px 10px;
            font-size: 11px;
            border-radius: 6px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chart-btn:hover {
            background: #e5e7eb;
        }
        
        .chart-btn.active {
            background: #38b2ac;
            color: white;
            border-color: #38b2ac;
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        /* Loading Spinner */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #38b2ac;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error-message {
            background-color: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }
        
        /* Table Styles */
        .data-table {
            width: 100%;
            font-size: 12px;
            border-collapse: collapse;
            background: white;
        }
        
        .data-table th {
            background-color: #38b2ac;
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #2c9c96;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .data-table td {
            padding: 8px 12px;
            border-bottom: 1px solid #f1f5f9;
            color: #475569;
        }
        
        .data-table tr:hover {
            background-color: #f8fafc;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9fafb;
        }
        
        .data-table tr:nth-child(even):hover {
            background-color: #f3f4f6;
        }
        
        /* Export Buttons */
        .export-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .export-btn {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .export-btn-chart {
            background-color: #38b2ac;
            color: white;
        }
        
        .export-btn-chart:hover {
            background-color: #319795;
        }
        
        .export-btn-data {
            background-color: #8b5cf6;
            color: white;
        }
        
        .export-btn-data:hover {
            background-color: #7c3aed;
        }
        
        /* Scrollable Table Container */
        .table-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-top: 10px;
            background: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.04);
        }
        
        /* Section header */
        .section-header {
            font-size: 13px;
            font-weight: 600;
        }
        
        /* Parabola Controls */
        .parabola-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .control-group {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .control-label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 8px;
        }
        
        .control-input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 12px;
            background: white;
        }
        
        .control-slider {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            outline: none;
            margin-top: 5px;
        }
        
        .control-value {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
            text-align: center;
        }
        
        .simulation-btn {
            background: linear-gradient(to right, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .simulation-btn:hover {
            background: linear-gradient(to right, #7c3aed, #6d28d9);
            transform: translateY(-2px);
        }
        
        .simulation-btn:active {
            transform: translateY(0);
        }
        
        .parabola-info {
            background: linear-gradient(to right, #dbeafe, #e0f2fe);
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 12px;
        }
        
        .info-label {
            color: #475569;
            font-weight: 500;
        }
        
        .info-value {
            color: #1e40af;
            font-weight: 600;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            background: #f3f4f6;
            border-radius: 10px;
            padding: 4px;
            margin-bottom: 15px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 8px 12px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: white;
            color: #38b2ac;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 380px) {
            .chart-container, .parabola-chart-container {
                height: 250px;
            }
            
            .data-table {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile App Container -->
    <div class="app-container">
        
        <!-- Loading Indicator -->
        <div id="loading" class="fixed inset-0 bg-white bg-opacity-90 flex flex-col items-center justify-center z-50">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-700 font-medium">Menyiapkan Simulasi Parabola...</p>
            <p class="text-gray-500 text-sm mt-2">Memuat komponen simulasi</p>
        </div>
        
        <!-- Error Message -->
        <div id="error-message" class="error-message m-4 hidden">
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle mr-3"></i>
                <div>
                    <p class="font-medium" id="error-title">Terjadi Kesalahan</p>
                    <p class="text-sm" id="error-detail"></p>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <main class="pb-24 p-4 custom-scrollbar" style="max-height: calc(100vh - 70px); overflow-y: auto;">
            <!-- Page Title -->
            <div class="mb-4">
                <h1 class="text-lg font-bold text-gray-800 mb-1">
                    <i class="fas fa-chart-line text-purple-500 mr-2"></i> Simulasi Parabola
                </h1>
                <p class="text-gray-600 text-xs">
                    Simulasi gerak parabola dengan data real-time yang dapat diunduh
                </p>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" id="tab-simulasi">
                    <i class="fas fa-rocket mr-1"></i> Simulasi
                </button>
                <button class="tab-btn" id="tab-data">
                    <i class="fas fa-table mr-1"></i> Data
                </button>
                <button class="tab-btn" id="tab-ekspor">
                    <i class="fas fa-download mr-1"></i> Ekspor
                </button>
            </div>
            
            <!-- Simulation Tab Content -->
            <div id="simulasi-content">
                <!-- Simulation Controls -->
                <div class="mb-6 p-4 bg-white border border-gray-200 rounded-xl shadow-sm">
                    <h3 class="section-header text-gray-700 flex items-center mb-4">
                        <i class="fas fa-sliders-h text-purple-500 mr-2 text-xs"></i> Kontrol Simulasi Parabola
                    </h3>
                    
                    <div class="parabola-controls">
                        <!-- Kecepatan Awal -->
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-tachometer-alt mr-1"></i> Kecepatan Awal (v₀)
                            </label>
                            <input type="range" min="10" max="100" value="50" class="control-slider" id="velocity-slider">
                            <div class="control-value" id="velocity-value">50 m/s</div>
                        </div>
                        
                        <!-- Sudut Elevasi -->
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-angle-up mr-1"></i> Sudut Elevasi (θ)
                            </label>
                            <input type="range" min="15" max="75" value="45" class="control-slider" id="angle-slider">
                            <div class="control-value" id="angle-value">45°</div>
                        </div>
                        
                        <!-- Gravitasi -->
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-weight-hanging mr-1"></i> Gravitasi (g)
                            </label>
                            <input type="range" min="5" max="15" value="9.8" step="0.1" class="control-slider" id="gravity-slider">
                            <div class="control-value" id="gravity-value">9.8 m/s²</div>
                        </div>
                        
                        <!-- Ketinggian Awal -->
                        <div class="control-group">
                            <label class="control-label">
                                <i class="fas fa-mountain mr-1"></i> Ketinggian Awal (h₀)
                            </label>
                            <input type="range" min="0" max="100" value="0" class="control-slider" id="height-slider">
                            <div class="control-value" id="height-value">0 m</div>
                        </div>
                    </div>
                    
                    <!-- Simulation Buttons -->
                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <button id="btn-start-simulation" class="simulation-btn">
                            <i class="fas fa-play"></i> Mulai Simulasi
                        </button>
                        <button id="btn-reset-simulation" class="simulation-btn" style="background: linear-gradient(to right, #6b7280, #4b5563);">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                        <button id="btn-pause-simulation" class="simulation-btn col-span-2" style="background: linear-gradient(to right, #f59e0b, #d97706);">
                            <i class="fas fa-pause"></i> Jeda / Lanjutkan
                        </button>
                    </div>
                </div>
                
                <!-- Parabola Chart -->
                <div class="mb-6 p-4 bg-white border border-gray-200 rounded-xl shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="section-header text-gray-700 flex items-center">
                            <i class="fas fa-project-diagram text-blue-500 mr-2 text-xs"></i> Grafik Lintasan Parabola
                        </h3>
                        <div class="text-xs text-gray-500">
                            <span id="simulation-time">0.0</span> s
                        </div>
                    </div>
                    
                    <div class="parabola-chart-container">
                        <!-- Empty State for Parabola Chart -->
                        <div id="parabola-empty-state" class="empty-chart">
                            <i class="fas fa-chart-line empty-chart-icon"></i>
                            <p class="empty-chart-text">
                                Grafik akan muncul setelah simulasi dimulai.<br>
                                Klik "Mulai Simulasi" untuk memulai.
                            </p>
                        </div>
                        <canvas id="parabola-chart"></canvas>
                    </div>
                    
                    <!-- Simulation Info -->
                    <div class="parabola-info">
                        <div class="info-row">
                            <span class="info-label">Jangkauan Maksimum (R):</span>
                            <span class="info-value" id="info-range">- m</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ketinggian Maksimum (H):</span>
                            <span class="info-value" id="info-max-height">- m</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Waktu Total (T):</span>
                            <span class="info-value" id="info-total-time">- s</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Kecepatan Akhir (v):</span>
                            <span class="info-value" id="info-final-velocity">- m/s</span>
                        </div>
                    </div>
                </div>
                
                <!-- Real-time Data Visualization -->
                <div class="mb-6 p-4 bg-white border border-gray-200 rounded-xl shadow-sm">
                    <h3 class="section-header text-gray-700 flex items-center mb-4">
                        <i class="fas fa-chart-bar text-green-500 mr-2 text-xs"></i> Visualisasi Data Real-time
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <p class="text-xs text-blue-700">Posisi X</p>
                            <p id="current-x" class="text-lg font-bold text-blue-800">- m</p>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg">
                            <p class="text-xs text-green-700">Posisi Y</p>
                            <p id="current-y" class="text-lg font-bold text-green-800">- m</p>
                        </div>
                        <div class="bg-purple-50 p-3 rounded-lg">
                            <p class="text-xs text-purple-700">Kecepatan X</p>
                            <p id="current-vx" class="text-lg font-bold text-purple-800">- m/s</p>
                        </div>
                        <div class="bg-red-50 p-3 rounded-lg">
                            <p class="text-xs text-red-700">Kecepatan Y</p>
                            <p id="current-vy" class="text-lg font-bold text-red-800">- m/s</p>
                        </div>
                    </div>
                    
                    <!-- Real-time Charts -->
                    <div class="chart-container mb-3">
                        <!-- Empty State for Velocity Chart -->
                        <div id="velocity-empty-state" class="empty-chart">
                            <i class="fas fa-tachometer-alt empty-chart-icon"></i>
                            <p class="empty-chart-text">
                                Grafik kecepatan akan muncul saat simulasi berjalan
                            </p>
                        </div>
                        <canvas id="velocity-chart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <!-- Empty State for Position Chart -->
                        <div id="position-empty-state" class="empty-chart">
                            <i class="fas fa-map-marker-alt empty-chart-icon"></i>
                            <p class="empty-chart-text">
                                Grafik posisi akan muncul saat simulasi berjalan
                            </p>
                        </div>
                        <canvas id="position-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Data Tab Content (Hidden by default) -->
            <div id="data-content" class="hidden">
                <div class="mb-6 p-4 bg-white border border-gray-200 rounded-xl shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="section-header text-gray-700 flex items-center">
                            <i class="fas fa-database text-purple-500 mr-2 text-xs"></i> Data Tabel Simulasi Real-time
                        </h3>
                        <button id="btn-clear-data" class="text-xs px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200">
                            <i class="fas fa-trash mr-1"></i> Hapus Data
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table" id="parabola-table">
                            <thead>
                                <tr>
                                    <th>Waktu (s)</th>
                                    <th>Posisi X (m)</th>
                                    <th>Posisi Y (m)</th>
                                    <th>Vx (m/s)</th>
                                    <th>Vy (m/s)</th>
                                </tr>
                            </thead>
                            <tbody id="parabola-table-body">
                                <!-- Data rows will be inserted here -->
                                <tr>
                                    <td colspan="5" class="text-center py-6 text-gray-500">
                                        <i class="fas fa-database text-2xl mb-2 block text-gray-300"></i>
                                        <p class="text-sm">Belum ada data simulasi</p>
                                        <p class="text-xs mt-1">Klik "Mulai Simulasi" untuk memulai</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4 grid grid-cols-3 gap-3">
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <p class="text-xs text-gray-600">Data Points</p>
                            <p id="data-count" class="text-lg font-bold text-gray-800">0</p>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <p class="text-xs text-gray-600">Interval</p>
                            <p id="data-interval" class="text-lg font-bold text-gray-800">0.1 s</p>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <p class="text-xs text-gray-600">Status</p>
                            <p id="data-status" class="text-lg font-bold text-green-600">Siap</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Export Tab Content (Hidden by default) -->
            <div id="ekspor-content" class="hidden">
                <div class="mb-6 p-4 bg-white border border-gray-200 rounded-xl shadow-sm">
                    <h3 class="section-header text-gray-700 flex items-center mb-4">
                        <i class="fas fa-file-export text-green-500 mr-2 text-xs"></i> Ekspor Data Simulasi
                    </h3>
                    
                    <div class="space-y-4">
                        <!-- Export Options -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="text-sm font-semibold text-blue-800 mb-3">
                                <i class="fas fa-cog mr-2"></i> Pengaturan Ekspor
                            </h4>
                            
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Format Data</label>
                                    <select id="export-format" class="w-full p-2 border border-gray-300 rounded text-xs">
                                        <option value="csv">CSV (Excel)</option>
                                        <option value="json">JSON</option>
                                        <option value="txt">Teks</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Presisi Data</label>
                                    <select id="export-precision" class="w-full p-2 border border-gray-300 rounded text-xs">
                                        <option value="2">2 Desimal</option>
                                        <option value="3">3 Desimal</option>
                                        <option value="4">4 Desimal</option>
                                        <option value="6">6 Desimal</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <label class="block text-xs font-medium text-gray-700 mb-1">Rentang Data</label>
                                <div class="flex gap-2">
                                    <input type="number" id="export-start" value="0" min="0" step="0.1" class="flex-1 p-2 border border-gray-300 rounded text-xs" placeholder="Mulai (s)">
                                </div>
                                <div class="flex gap-2">
                                    <input type="number" id="export-end" value="10" min="0" step="0.1" class="flex-1 p-2 border border-gray-300 rounded text-xs" placeholder="Selesai (s)">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Buttons -->
                        <div class="grid grid-cols-2 gap-3">
                            <button id="btn-export-csv" class="export-btn export-btn-data">
                                <i class="fas fa-file-csv"></i> Download CSV
                            </button>
                            <button id="btn-export-chart" class="export-btn export-btn-chart">
                                <i class="fas fa-chart-line"></i> Download Grafik
                            </button>
                            <button id="btn-export-all" class="export-btn col-span-2" style="background: linear-gradient(to right, #10b981, #059669); color: white;">
                                <i class="fas fa-file-archive"></i> Download Semua Data
                            </button>
                        </div>
                        
                        <!-- Export Preview -->
                        <div class="mt-4">
                            <label class="block text-xs font-medium text-gray-700 mb-2">
                                <i class="fas fa-eye mr-1"></i> Pratinjau Data
                            </label>
                            <div class="bg-gray-50 p-3 rounded-lg max-h-40 overflow-y-auto">
                                <pre id="export-preview" class="text-xs text-gray-600">Belum ada data simulasi. Jalankan simulasi terlebih dahulu.</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Information Panel -->
            <div class="mb-6 p-4 bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200 rounded-xl">
                <h3 class="section-header text-gray-700 mb-3 flex items-center">
                    <i class="fas fa-info-circle text-purple-500 mr-2 text-xs"></i> Informasi Simulasi Parabola
                </h3>
                
                <div class="space-y-3">
                    <div class="text-xs text-gray-700">
                        <p class="mb-2"><span class="font-bold">Rumus Gerak Parabola:</span></p>
                        <div class="bg-white p-2 rounded-lg mb-2">
                            <p class="mb-1">x(t) = v₀ cos(θ) t</p>
                            <p class="mb-1">y(t) = v₀ sin(θ) t - ½ g t² + h₀</p>
                            <p>v₀ = kecepatan awal, θ = sudut elevasi, g = gravitasi</p>
                        </div>
                        
                        <p class="mb-2"><span class="font-bold">Parameter yang Dapat Diubah:</span></p>
                        <ul class="list-disc pl-4 space-y-1">
                            <li>Kecepatan awal (v₀): 10 - 100 m/s</li>
                            <li>Sudut elevasi (θ): 15° - 75°</li>
                            <li>Gravitasi (g): 5 - 15 m/s²</li>
                            <li>Ketinggian awal (h₀): 0 - 100 m</li>
                        </ul>
                    </div>
                    
                    <!-- Quick Tips -->
                    <div class="mt-4 pt-3 border-t border-purple-100">
                        <p class="text-xs font-medium text-gray-700 mb-2">Tips Simulasi:</p>
                        <div class="text-xs text-gray-600 space-y-1">
                            <div class="flex items-start">
                                <i class="fas fa-lightbulb text-yellow-500 mt=0.5 mr-2"></i>
                                <span>Sudut 45° menghasilkan jangkauan maksimum</span>
                            </div>
                            <div class="flex items-start">
                                <i class="fas fa-lightbulb text-yellow-500 mt-0.5 mr-2"></i>
                                <span>Gravitasi mempengaruhi waktu dan ketinggian</span>
                            </div>
                            <div class="flex items-start">
                                <i class="fas fa-lightbulb text-yellow-500 mt-0.5 mr-2"></i>
                                <span>Data otomatis direkam setiap 0.1 detik</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
          <a href="../../dashboard siswa.html" class="nav-item">
            <i class="fas fa-home nav-icon"></i>
            <span>Beranda</span>
          </a>
          <a href="../../soal harian/dashboard soal.html" class="nav-item">
            <i class="fas fa-flask nav-icon"></i>
            <span>Soal Harian</span>
          </a>
          <a href="../../ai/nayra.html" class="nav-item">
            <i class="fas fa-robot nav-icon"></i>
            <span>Nayra AI</span>
          </a>
          <a href="../../materi harian/kategori materi.html" class="nav-item">
            <i class="fas fa-chalkboard-teacher nav-icon"></i>
            <span>Materi Harian</span>
          </a>
          <a href="../../profil/profil.html" class="nav-item">
            <i class="fas fa-user nav-icon"></i>
            <span>Profil</span>
          </a>
        </nav>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // DOM Elements
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const errorTitle = document.getElementById('error-title');
        const errorDetail = document.getElementById('error-detail');
        
        // Tab Elements
        const tabSimulasi = document.getElementById('tab-simulasi');
        const tabData = document.getElementById('tab-data');
        const tabEkspor = document.getElementById('tab-ekspor');
        const simulasiContent = document.getElementById('simulasi-content');
        const dataContent = document.getElementById('data-content');
        const eksporContent = document.getElementById('ekspor-content');
        
        // Control Elements
        const velocitySlider = document.getElementById('velocity-slider');
        const angleSlider = document.getElementById('angle-slider');
        const gravitySlider = document.getElementById('gravity-slider');
        const heightSlider = document.getElementById('height-slider');
        
        const velocityValue = document.getElementById('velocity-value');
        const angleValue = document.getElementById('angle-value');
        const gravityValue = document.getElementById('gravity-value');
        const heightValue = document.getElementById('height-value');
        
        const btnStartSimulation = document.getElementById('btn-start-simulation');
        const btnResetSimulation = document.getElementById('btn-reset-simulation');
        const btnPauseSimulation = document.getElementById('btn-pause-simulation');
        
        // Display Elements
        const simulationTime = document.getElementById('simulation-time');
        const currentX = document.getElementById('current-x');
        const currentY = document.getElementById('current-y');
        const currentVx = document.getElementById('current-vx');
        const currentVy = document.getElementById('current-vy');
        
        // Info Elements
        const infoRange = document.getElementById('info-range');
        const infoMaxHeight = document.getElementById('info-max-height');
        const infoTotalTime = document.getElementById('info-total-time');
        const infoFinalVelocity = document.getElementById('info-final-velocity');
        
        // Empty State Elements
        const parabolaEmptyState = document.getElementById('parabola-empty-state');
        const velocityEmptyState = document.getElementById('velocity-empty-state');
        const positionEmptyState = document.getElementById('position-empty-state');
        
        // Data Elements
        const parabolaTableBody = document.getElementById('parabola-table-body');
        const btnClearData = document.getElementById('btn-clear-data');
        const dataCount = document.getElementById('data-count');
        const dataInterval = document.getElementById('data-interval');
        const dataStatus = document.getElementById('data-status');
        
        // Export Elements
        const exportFormat = document.getElementById('export-format');
        const exportPrecision = document.getElementById('export-precision');
        const exportStart = document.getElementById('export-start');
        const exportEnd = document.getElementById('export-end');
        const exportPreview = document.getElementById('export-preview');
        const btnExportCSV = document.getElementById('btn-export-csv');
        const btnExportChart = document.getElementById('btn-export-chart');
        const btnExportAll = document.getElementById('btn-export-all');
        
        // Chart Elements
        const parabolaChartCanvas = document.getElementById('parabola-chart');
        const velocityChartCanvas = document.getElementById('velocity-chart');
        const positionChartCanvas = document.getElementById('position-chart');
        
        // Variables
        let parabolaChart = null;
        let velocityChart = null;
        let positionChart = null;
        
        let simulationRunning = false;
        let simulationPaused = false;
        let simulationTimeValue = 0;
        let simulationInterval = null;
        let simulationData = [];
        
        // Simulation Parameters
        let params = {
            v0: 50,        // Initial velocity (m/s)
            angle: 45,     // Launch angle (degrees)
            g: 9.8,        // Gravity (m/s²)
            h0: 0,         // Initial height (m)
            dt: 0.1        // Time step (s)
        };
        
        // Initialize
        function init() {
            try {
                // Initialize charts (empty)
                initParabolaChart();
                initVelocityChart();
                initPositionChart();
                
                // Hide charts initially, show empty states
                parabolaChartCanvas.style.display = 'none';
                velocityChartCanvas.style.display = 'none';
                positionChartCanvas.style.display = 'none';
                
                // Set up control listeners
                setupControls();
                
                // Hide loading
                setTimeout(() => {
                    loading.classList.add('hidden');
                }, 1000);
                
            } catch (err) {
                console.error('Error initializing simulation:', err);
                showError('Inisialisasi Gagal', 'Gagal memuat komponen simulasi');
            }
        }
        
        // Initialize parabola chart (empty)
        function initParabolaChart() {
            const ctx = parabolaChartCanvas.getContext('2d');
            
            parabolaChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Lintasan Parabola',
                        data: [],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.2)',
                        borderWidth: 2,
                        pointRadius: 3,
                        pointBackgroundColor: '#8b5cf6',
                        showLine: true,
                        fill: false,
                        tension: 0.4
                    }, {
                        label: 'Posisi Saat Ini',
                        data: [],
                        borderColor: '#f59e0b',
                        backgroundColor: '#f59e0b',
                        borderWidth: 3,
                        pointRadius: 6,
                        pointStyle: 'circle',
                        showLine: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Lintasan Gerak Parabola',
                            font: {
                                size: 13,
                                weight: 'bold',
                                family: "'Baloo 2', cursive"
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Jarak Horizontal (m)',
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            beginAtZero: true,
                            suggestedMax: 100
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Ketinggian (m)',
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            beginAtZero: true,
                            suggestedMax: 50
                        }
                    }
                }
            });
        }
        
        // Initialize velocity chart (empty)
        function initVelocityChart() {
            const ctx = velocityChartCanvas.getContext('2d');
            
            velocityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Kecepatan Horizontal (Vx)',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Kecepatan Vertikal (Vy)',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            }
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Waktu (s)',
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            suggestedMax: 10
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Kecepatan (m/s)',
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            suggestedMin: -60,
                            suggestedMax: 60
                        }
                    }
                }
            });
        }
        
        // Initialize position chart (empty)
        function initPositionChart() {
            const ctx = positionChartCanvas.getContext('2d');
            
            positionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Posisi Horizontal (X)',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Posisi Vertikal (Y)',
                        data: [],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            }
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Waktu (s)',
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            suggestedMax: 10
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Posisi (m)',
                                font: {
                                    size: 11,
                                    family: "'Baloo 2', cursive"
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            suggestedMax: 100
                        }
                    }
                }
            });
        }
        
        // Set up control listeners
        function setupControls() {
            // Update parameter values
            velocitySlider.addEventListener('input', (e) => {
                params.v0 = parseFloat(e.target.value);
                velocityValue.textContent = `${params.v0} m/s`;
            });
            
            angleSlider.addEventListener('input', (e) => {
                params.angle = parseFloat(e.target.value);
                angleValue.textContent = `${params.angle}°`;
            });
            
            gravitySlider.addEventListener('input', (e) => {
                params.g = parseFloat(e.target.value);
                gravityValue.textContent = `${params.g} m/s²`;
            });
            
            heightSlider.addEventListener('input', (e) => {
                params.h0 = parseFloat(e.target.value);
                heightValue.textContent = `${params.h0} m`;
            });
            
            // Simulation controls
            btnStartSimulation.addEventListener('click', startSimulation);
            btnResetSimulation.addEventListener('click', resetSimulation);
            btnPauseSimulation.addEventListener('click', togglePauseSimulation);
            
            // Tab navigation
            tabSimulasi.addEventListener('click', () => switchTab('simulasi'));
            tabData.addEventListener('click', () => switchTab('data'));
            tabEkspor.addEventListener('click', () => switchTab('ekspor'));
            
            // Data controls
            btnClearData.addEventListener('click', clearData);
            
            // Export controls
            btnExportCSV.addEventListener('click', exportCSV);
            btnExportChart.addEventListener('click', exportChart);
            btnExportAll.addEventListener('click', exportAll);
            
            exportFormat.addEventListener('change', updateExportPreview);
            exportPrecision.addEventListener('change', updateExportPreview);
            exportStart.addEventListener('change', updateExportPreview);
            exportEnd.addEventListener('change', updateExportPreview);
        }
        
        // Calculate parabola trajectory (for display only when simulation starts)
        function calculateParabola() {
            // Convert angle to radians
            const angleRad = params.angle * Math.PI / 180;
            
            // Calculate initial velocities
            const v0x = params.v0 * Math.cos(angleRad);
            const v0y = params.v0 * Math.sin(angleRad);
            
            // Calculate total time of flight
            const discriminant = Math.pow(v0y, 2) + 2 * params.g * params.h0;
            const totalTime = (v0y + Math.sqrt(discriminant)) / params.g;
            
            // Calculate maximum height
            const timeToMaxHeight = v0y / params.g;
            const maxHeight = params.h0 + (v0y * timeToMaxHeight) - (0.5 * params.g * Math.pow(timeToMaxHeight, 2));
            
            // Calculate range
            const range = v0x * totalTime;
            
            // Calculate final velocity magnitude
            const finalVy = v0y - params.g * totalTime;
            const finalVelocity = Math.sqrt(Math.pow(v0x, 2) + Math.pow(finalVy, 2));
            
            // Update info display
            infoRange.textContent = `${range.toFixed(2)} m`;
            infoMaxHeight.textContent = `${maxHeight.toFixed(2)} m`;
            infoTotalTime.textContent = `${totalTime.toFixed(2)} s`;
            infoFinalVelocity.textContent = `${finalVelocity.toFixed(2)} m/s`;
            
            return {
                v0x,
                v0y,
                totalTime,
                maxHeight,
                range,
                finalVelocity
            };
        }
        
        // Start simulation
        function startSimulation() {
            if (simulationRunning) return;
            
            // Calculate initial values
            const calculatedValues = calculateParabola();
            
            simulationRunning = true;
            simulationPaused = false;
            simulationTimeValue = 0;
            simulationData = [];
            
            btnStartSimulation.disabled = true;
            btnStartSimulation.innerHTML = '<i class="fas fa-sync-alt spin"></i> Simulasi Berjalan';
            btnPauseSimulation.innerHTML = '<i class="fas fa-pause"></i> Jeda Simulasi';
            
            dataStatus.textContent = 'Merekam';
            dataStatus.className = 'text-lg font-bold text-yellow-600';
            
            // Hide empty states and show charts
            parabolaEmptyState.style.display = 'none';
            velocityEmptyState.style.display = 'none';
            positionEmptyState.style.display = 'none';
            
            parabolaChartCanvas.style.display = 'block';
            velocityChartCanvas.style.display = 'block';
            positionChartCanvas.style.display = 'block';
            
            // Clear previous data from charts
            clearCharts();
            
            // Set chart scales based on calculated values
            if (parabolaChart) {
                parabolaChart.options.scales.x.suggestedMax = calculatedValues.range * 1.1;
                parabolaChart.options.scales.y.suggestedMax = calculatedValues.maxHeight * 1.2;
                parabolaChart.update();
            }
            
            if (velocityChart) {
                velocityChart.options.scales.x.suggestedMax = calculatedValues.totalTime * 1.1;
                velocityChart.update();
            }
            
            if (positionChart) {
                positionChart.options.scales.x.suggestedMax = calculatedValues.totalTime * 1.1;
                positionChart.options.scales.y.suggestedMax = calculatedValues.maxHeight * 1.2;
                positionChart.update();
            }
            
            // Start simulation loop
            simulationInterval = setInterval(updateSimulation, 100);
            
            showError('Simulasi Dimulai', 'Simulasi parabola sedang berjalan');
        }
        
        // Reset simulation
        function resetSimulation() {
            stopSimulation();
            simulationTimeValue = 0;
            simulationData = [];
            
            updateDisplay(0, 0, 0, 0, 0);
            clearCharts();
            updateDataTable();
            
            // Show empty states again
            parabolaEmptyState.style.display = 'flex';
            velocityEmptyState.style.display = 'flex';
            positionEmptyState.style.display = 'flex';
            
            parabolaChartCanvas.style.display = 'none';
            velocityChartCanvas.style.display = 'none';
            positionChartCanvas.style.display = 'none';
            
            simulationTime.textContent = '0.0';
            currentX.textContent = '- m';
            currentY.textContent = '- m';
            currentVx.textContent = '- m/s';
            currentVy.textContent = '- m/s';
            
            infoRange.textContent = '- m';
            infoMaxHeight.textContent = '- m';
            infoTotalTime.textContent = '- s';
            infoFinalVelocity.textContent = '- m/s';
            
            dataStatus.textContent = 'Siap';
            dataStatus.className = 'text-lg font-bold text-green-600';
            
            showError('Simulasi Direset', 'Semua data telah direset');
        }
        
        // Toggle pause simulation
        function togglePauseSimulation() {
            if (!simulationRunning) return;
            
            simulationPaused = !simulationPaused;
            
            if (simulationPaused) {
                btnPauseSimulation.innerHTML = '<i class="fas fa-play"></i> Lanjutkan';
                dataStatus.textContent = 'Dijeda';
                dataStatus.className = 'text-lg font-bold text-red-600';
                showError('Simulasi Dijeda', 'Simulasi dijeda sementara');
            } else {
                btnPauseSimulation.innerHTML = '<i class="fas fa-pause"></i> Jeda Simulasi';
                dataStatus.textContent = 'Merekam';
                dataStatus.className = 'text-lg font-bold text-yellow-600';
                showError('Simulasi Dilanjutkan', 'Simulasi dilanjutkan');
            }
        }
        
        // Stop simulation
        function stopSimulation() {
            simulationRunning = false;
            simulationPaused = false;
            
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
            
            btnStartSimulation.disabled = false;
            btnStartSimulation.innerHTML = '<i class="fas fa-play"></i> Mulai Simulasi';
        }
        
        // Update simulation
        function updateSimulation() {
            if (!simulationRunning || simulationPaused) return;
            
            // Convert angle to radians
            const angleRad = params.angle * Math.PI / 180;
            
            // Calculate velocities
            const v0x = params.v0 * Math.cos(angleRad);
            const v0y = params.v0 * Math.sin(angleRad);
            
            // Calculate positions
            const x = v0x * simulationTimeValue;
            const y = params.h0 + (v0y * simulationTimeValue) - (0.5 * params.g * Math.pow(simulationTimeValue, 2));
            
            // Calculate current velocities
            const vy = v0y - params.g * simulationTimeValue;
            
            // Stop simulation if object hits ground
            if (y <= 0 && simulationTimeValue > 0) {
                stopSimulation();
                dataStatus.textContent = 'Selesai';
                dataStatus.className = 'text-lg font-bold text-green-600';
                showError('Simulasi Selesai', 'Objek telah mencapai tanah');
                return;
            }
            
            // Update display
            updateDisplay(simulationTimeValue, x, y, v0x, vy);
            
            // Record data
            const dataPoint = {
                time: simulationTimeValue,
                x: x,
                y: y,
                vx: v0x,
                vy: vy
            };
            
            simulationData.push(dataPoint);
            updateCharts(dataPoint);
            updateDataTable();
            
            // Increment time
            simulationTimeValue += params.dt;
        }
        
        // Update display
        function updateDisplay(time, x, y, vx, vy) {
            simulationTime.textContent = time.toFixed(1);
            currentX.textContent = `${x.toFixed(2)} m`;
            currentY.textContent = `${y.toFixed(2)} m`;
            currentVx.textContent = `${vx.toFixed(2)} m/s`;
            currentVy.textContent = `${vy.toFixed(2)} m/s`;
            
            // Update current position on parabola chart
            if (parabolaChart) {
                parabolaChart.data.datasets[1].data = [{ x, y }];
                parabolaChart.update();
            }
        }
        
        // Update charts
        function updateCharts(dataPoint) {
            // Update velocity chart
            if (velocityChart) {
                velocityChart.data.labels.push(dataPoint.time.toFixed(1));
                velocityChart.data.datasets[0].data.push(dataPoint.vx);
                velocityChart.data.datasets[1].data.push(dataPoint.vy);
                
                // Keep only last 50 points
                if (velocityChart.data.labels.length > 50) {
                    velocityChart.data.labels.shift();
                    velocityChart.data.datasets[0].data.shift();
                    velocityChart.data.datasets[1].data.shift();
                }
                
                velocityChart.update('none');
            }
            
            // Update position chart
            if (positionChart) {
                if (positionChart.data.labels.length === 0) {
                    positionChart.data.labels = velocityChart.data.labels.slice();
                }
                
                positionChart.data.datasets[0].data.push(dataPoint.x);
                positionChart.data.datasets[1].data.push(dataPoint.y);
                
                // Keep only last 50 points
                if (positionChart.data.datasets[0].data.length > 50) {
                    positionChart.data.datasets[0].data.shift();
                    positionChart.data.datasets[1].data.shift();
                }
                
                positionChart.update('none');
            }
            
            // Update parabola trajectory chart with current data
            if (parabolaChart) {
                const trajectoryPoint = { x: dataPoint.x, y: dataPoint.y };
                parabolaChart.data.datasets[0].data.push(trajectoryPoint);
                
                // Keep only last 100 points
                if (parabolaChart.data.datasets[0].data.length > 100) {
                    parabolaChart.data.datasets[0].data.shift();
                }
                
                parabolaChart.update('none');
            }
        }
        
        // Clear charts
        function clearCharts() {
            if (velocityChart) {
                velocityChart.data.labels = [];
                velocityChart.data.datasets[0].data = [];
                velocityChart.data.datasets[1].data = [];
                velocityChart.update();
            }
            
            if (positionChart) {
                positionChart.data.labels = [];
                positionChart.data.datasets[0].data = [];
                positionChart.data.datasets[1].data = [];
                positionChart.update();
            }
            
            if (parabolaChart) {
                parabolaChart.data.datasets[0].data = [];
                parabolaChart.data.datasets[1].data = [];
                parabolaChart.update();
            }
        }
        
        // Update data table
        function updateDataTable() {
            parabolaTableBody.innerHTML = '';
            
            if (simulationData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" class="text-center py-6 text-gray-500">
                        <i class="fas fa-database text-2xl mb-2 block text-gray-300"></i>
                        <p class="text-sm">Belum ada data simulasi</p>
                        <p class="text-xs mt-1">Klik "Mulai Simulasi" untuk memulai</p>
                    </td>
                `;
                parabolaTableBody.appendChild(row);
                return;
            }
            
            // Show last 10 data points
            const startIndex = Math.max(0, simulationData.length - 10);
            
            for (let i = startIndex; i < simulationData.length; i++) {
                const data = simulationData[i];
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${data.time.toFixed(2)}</td>
                    <td>${data.x.toFixed(2)}</td>
                    <td>${data.y.toFixed(2)}</td>
                    <td>${data.vx.toFixed(2)}</td>
                    <td>${data.vy.toFixed(2)}</td>
                `;
                
                parabolaTableBody.appendChild(row);
            }
            
            // Update data count
            dataCount.textContent = simulationData.length;
            dataInterval.textContent = `${params.dt} s`;
        }
        
        // Clear data
        function clearData() {
            if (simulationData.length > 0 && confirm('Hapus semua data simulasi?')) {
                simulationData = [];
                updateDataTable();
                showError('Data Dihapus', 'Semua data simulasi telah dihapus');
            }
        }
        
        // Switch tab
        function switchTab(tab) {
            // Update tab buttons
            tabSimulasi.classList.remove('active');
            tabData.classList.remove('active');
            tabEkspor.classList.remove('active');
            
            simulasiContent.classList.add('hidden');
            dataContent.classList.add('hidden');
            eksporContent.classList.add('hidden');
            
            // Show selected tab
            switch(tab) {
                case 'simulasi':
                    tabSimulasi.classList.add('active');
                    simulasiContent.classList.remove('hidden');
                    break;
                case 'data':
                    tabData.classList.add('active');
                    dataContent.classList.remove('hidden');
                    updateDataTable();
                    break;
                case 'ekspor':
                    tabEkspor.classList.add('active');
                    eksporContent.classList.remove('hidden');
                    updateExportPreview();
                    break;
            }
        }
        
        // Update export preview
        function updateExportPreview() {
            if (simulationData.length === 0) {
                exportPreview.textContent = 'Belum ada data simulasi. Jalankan simulasi terlebih dahulu.';
                return;
            }
            
            const precision = parseInt(exportPrecision.value);
            const startTime = parseFloat(exportStart.value);
            const endTime = parseFloat(exportEnd.value);
            
            // Filter data by time range
            const filteredData = simulationData.filter(d => 
                d.time >= startTime && d.time <= endTime
            );
            
            if (filteredData.length === 0) {
                exportPreview.textContent = 'Tidak ada data dalam rentang waktu yang dipilih';
                return;
            }
            
            const format = exportFormat.value;
            let preview = '';
            
            if (format === 'csv') {
                preview = 'Waktu (s),Posisi X (m),Posisi Y (m),Kecepatan X (m/s),Kecepatan Y (m/s)\n';
                filteredData.slice(0, 5).forEach(data => {
                    preview += `${data.time.toFixed(precision)},${data.x.toFixed(precision)},${data.y.toFixed(precision)},${data.vx.toFixed(precision)},${data.vy.toFixed(precision)}\n`;
                });
                if (filteredData.length > 5) {
                    preview += `... (${filteredData.length - 5} data lainnya)\n`;
                    preview += `Total: ${filteredData.length} data points`;
                }
            } else if (format === 'json') {
                const previewData = filteredData.slice(0, 3).map(data => ({
                    time: data.time.toFixed(precision),
                    x: data.x.toFixed(precision),
                    y: data.y.toFixed(precision),
                    vx: data.vx.toFixed(precision),
                    vy: data.vy.toFixed(precision)
                }));
                preview = JSON.stringify(previewData, null, 2);
                if (filteredData.length > 3) {
                    preview += `\n... (${filteredData.length - 3} data lainnya)\n`;
                    preview += `Total: ${filteredData.length} data points`;
                }
            } else {
                filteredData.slice(0, 5).forEach(data => {
                    preview += `t=${data.time.toFixed(precision)}s: x=${data.x.toFixed(precision)}m, y=${data.y.toFixed(precision)}m, vx=${data.vx.toFixed(precision)}m/s, vy=${data.vy.toFixed(precision)}m/s\n`;
                });
                if (filteredData.length > 5) {
                    preview += `... (${filteredData.length - 5} data lainnya)\n`;
                    preview += `Total: ${filteredData.length} data points`;
                }
            }
            
            exportPreview.textContent = preview;
        }
        
        // Export CSV
        function exportCSV() {
            if (simulationData.length === 0) {
                showError('Data Tidak Tersedia', 'Tidak ada data untuk diekspor');
                return;
            }
            
            const precision = parseInt(exportPrecision.value);
            const startTime = parseFloat(exportStart.value);
            const endTime = parseFloat(exportEnd.value);
            
            // Filter data by time range
            const filteredData = simulationData.filter(d => 
                d.time >= startTime && d.time <= endTime
            );
            
            if (filteredData.length === 0) {
                showError('Data Tidak Ditemukan', 'Tidak ada data dalam rentang waktu yang dipilih');
                return;
            }
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Waktu (s),Posisi X (m),Posisi Y (m),Kecepatan X (m/s),Kecepatan Y (m/s)\n";
            
            filteredData.forEach(data => {
                const row = [
                    data.time.toFixed(precision),
                    data.x.toFixed(precision),
                    data.y.toFixed(precision),
                    data.vx.toFixed(precision),
                    data.vy.toFixed(precision)
                ].join(',');
                csvContent += row + "\n";
            });
            
            // Add metadata
            csvContent += "\n\nMETADATA SIMULASI\n";
            csvContent += `Parameter,Tipe,Nilai\n`;
            csvContent += `Kecepatan Awal,Numerik,${params.v0} m/s\n`;
            csvContent += `Sudut Elevasi,Numerik,${params.angle}°\n`;
            csvContent += `Gravitasi,Numerik,${params.g} m/s²\n`;
            csvContent += `Ketinggian Awal,Numerik,${params.h0} m\n`;
            csvContent += `Interval Waktu,Numerik,${params.dt} s\n`;
            csvContent += `Jumlah Data,Numerik,${filteredData.length}\n`;
            csvContent += `Tanggal Ekspor,Teks,${new Date().toLocaleString('id-ID')}\n`;
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `data-parabola-${new Date().toISOString().slice(0, 10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showError('CSV Tersimpan', `${filteredData.length} data telah diunduh sebagai CSV`);
        }
        
        // Export chart as PNG - FIXED VERSION
        function exportChart() {
            if (!parabolaChart || simulationData.length === 0) {
                showError('Grafik Tidak Tersedia', 'Tidak ada data simulasi untuk diekspor');
                return;
            }
            
            try {
                // Create a temporary canvas for high-quality export
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                
                // Set dimensions for high-quality export
                tempCanvas.width = 2000;
                tempCanvas.height = 1400;
                
                // White background
                tempCtx.fillStyle = 'white';
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                
                // Add title and metadata
                tempCtx.fillStyle = '#1f2937';
                tempCtx.font = 'bold 36px "Baloo 2", Arial, sans-serif';
                tempCtx.textAlign = 'center';
                tempCtx.fillText('SIMULASI GERAK PARABOLA - QUANTARA', tempCanvas.width / 2, 60);
                
                tempCtx.font = '24px "Baloo 2", Arial, sans-serif';
                tempCtx.fillStyle = '#4b5563';
                tempCtx.fillText(`Parameter: v₀=${params.v0} m/s, θ=${params.angle}°, g=${params.g} m/s², h₀=${params.h0} m`, tempCanvas.width / 2, 110);
                tempCtx.fillText(`Tanggal: ${new Date().toLocaleString('id-ID')}`, tempCanvas.width / 2, 150);
                
                // Export each chart to image and draw on temp canvas
                const chartCanvases = [
                    {canvas: parabolaChartCanvas, title: 'Grafik Lintasan Parabola', y: 200},
                    {canvas: velocityChartCanvas, title: 'Grafik Kecepatan vs Waktu', y: 650},
                    {canvas: positionChartCanvas, title: 'Grafik Posisi vs Waktu', y: 1000}
                ];
                
                let chartsLoaded = 0;
                const totalCharts = chartCanvases.length;
                
                chartCanvases.forEach((item, index) => {
                    const chartImg = new Image();
                    
                    chartImg.onload = function() {
                        // Draw chart image
                        const chartHeight = 400;
                        tempCtx.drawImage(chartImg, 100, item.y, tempCanvas.width - 200, chartHeight);
                        
                        // Add title for each chart
                        tempCtx.fillStyle = '#1f2937';
                        tempCtx.font = 'bold 28px "Baloo 2", Arial, sans-serif';
                        tempCtx.textAlign = 'left';
                        tempCtx.fillText(item.title, 100, item.y - 20);
                        
                        chartsLoaded++;
                        
                        // If all charts are loaded, create the download
                        if (chartsLoaded === totalCharts) {
                            // Add simulation info at the bottom
                            const calculatedValues = calculateParabola();
                            tempCtx.font = '20px "Baloo 2", Arial, sans-serif';
                            tempCtx.textAlign = 'left';
                            tempCtx.fillStyle = '#374151';
                            
                            const infoY = 1350;
                            tempCtx.fillText(`Informasi Simulasi:`, 100, infoY);
                            tempCtx.fillText(`• Jangkauan Maksimum: ${calculatedValues.range.toFixed(2)} m`, 120, infoY + 35);
                            tempCtx.fillText(`• Ketinggian Maksimum: ${calculatedValues.maxHeight.toFixed(2)} m`, 120, infoY + 70);
                            tempCtx.fillText(`• Waktu Total: ${calculatedValues.totalTime.toFixed(2)} s`, 120, infoY + 105);
                            tempCtx.fillText(`• Data Points: ${simulationData.length}`, 120, infoY + 140);
                            
                            // Add footer
                            tempCtx.font = '16px "Baloo 2", Arial, sans-serif';
                            tempCtx.fillStyle = '#6b7280';
                            tempCtx.textAlign = 'center';
                            tempCtx.fillText('Dibuat dengan QUANTARA - Simulator Fisika Interaktif', tempCanvas.width / 2, 1380);
                            
                            // Trigger download
                            setTimeout(() => {
                                const dataUrl = tempCanvas.toDataURL('image/png');
                                const link = document.createElement('a');
                                link.download = `grafik-parabola-quantara-${new Date().toISOString().slice(0, 10)}.png`;
                                link.href = dataUrl;
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                
                                showError('Grafik Tersimpan', 'Grafik parabola telah diunduh sebagai PNG');
                            }, 100);
                        }
                    };
                    
                    chartImg.onerror = function() {
                        chartsLoaded++;
                        console.error(`Failed to load chart image ${index + 1}`);
                        
                        // Continue even if one chart fails
                        if (chartsLoaded === totalCharts) {
                            // Create download even with missing charts
                            setTimeout(() => {
                                const dataUrl = tempCanvas.toDataURL('image/png');
                                const link = document.createElement('a');
                                link.download = `grafik-parabola-quantara-${new Date().toISOString().slice(0, 10)}.png`;
                                link.href = dataUrl;
                                document.body.appendChild(link);
                                link.click();
                                document.body.removeChild(link);
                                
                                showError('Grafik Tersimpan', 'Grafik parabola telah diunduh sebagai PNG (beberapa grafik mungkin tidak tampil)');
                            }, 100);
                        }
                    };
                    
                    // Get base64 image from chart with better quality
                    const originalChart = index === 0 ? parabolaChart : 
                                        index === 1 ? velocityChart : 
                                        positionChart;
                    
                    // Temporarily increase chart size for better quality
                    const originalDisplay = item.canvas.style.display;
                    const originalWidth = item.canvas.width;
                    const originalHeight = item.canvas.height;
                    
                    // Create a temporary canvas for high-res export of this specific chart
                    const tempChartCanvas = document.createElement('canvas');
                    tempChartCanvas.width = 1800;
                    tempChartCanvas.height = 600;
                    const tempChartCtx = tempChartCanvas.getContext('2d');
                    
                    // Draw white background
                    tempChartCtx.fillStyle = 'white';
                    tempChartCtx.fillRect(0, 0, tempChartCanvas.width, tempChartCanvas.height);
                    
                    // Draw the chart
                    tempChartCtx.drawImage(item.canvas, 0, 0, tempChartCanvas.width, tempChartCanvas.height);
                    
                    // Use the temporary canvas for the image
                    chartImg.src = tempChartCanvas.toDataURL('image/png', 1.0);
                });
                
            } catch (error) {
                console.error('Error exporting chart:', error);
                showError('Ekspor Gagal', 'Terjadi kesalahan saat mengekspor grafik. Silakan coba lagi.');
                
                // Fallback: export just the parabola chart
                try {
                    const dataUrl = parabolaChartCanvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    link.download = `grafik-parabola-quantara-${new Date().toISOString().slice(0, 10)}.png`;
                    link.href = dataUrl;
                    link.click();
                    showError('Grafik Tersimpan (Fallback)', 'Grafik utama telah diunduh');
                } catch (fallbackError) {
                    showError('Ekspor Gagal Total', 'Tidak dapat mengekspor grafik. Pastikan simulasi telah berjalan dan ada data.');
                }
            }
        }
        
        // Export all data
        function exportAll() {
            if (simulationData.length === 0) {
                showError('Data Tidak Tersedia', 'Tidak ada data untuk diekspor');
                return;
            }
            
            // Export CSV
            exportCSV();
            
            // Wait a moment then export chart
            setTimeout(() => {
                exportChart();
            }, 1500);
            
            showError('Ekspor Lengkap', 'Data CSV dan grafik PNG sedang diunduh');
        }
        
        // Error handling
        function showError(title, message) {
            errorTitle.textContent = title;
            errorDetail.textContent = message;
            errorMessage.classList.remove('hidden');
            
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 3000);
        }
        
        // Add spin animation
        const style = document.createElement('style');
        style.textContent = `
            .spin {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
