<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TETA SAINS - Game Lakmus: Asam, Basa & Netral</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #38b2ac;
            --secondary: #0e7490;
            --accent: #f59e0b;
            --physics: #3b82f6;
            --chemistry: #10b981;
            --biology: #8b5cf6;
            --astronomy: #ec4899;
            --acid: #ef4444;
            --base: #3b82f6;
            --neutral: #6b7280;
        }
        
        body {
            font-family: 'Baloo 2', cursive;
            background-color: #f8fafc;
        }
        
        .app-container {
            max-width: 414px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* NAVBAR - TIDAK DIRUBAH */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 414px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            background: white;
            z-index: 10;
            height: 70px;
            display: flex;
            align-items: center;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            text-decoration: none;
            flex: 1;
            height: 100%;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
        }
        
        .nav-item span {
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-icon {
            transition: all 0.3s ease;
            font-size: 1.25rem;
        }
        
        .nav-icon.active {
            transform: translateY(-5px);
            color: var(--primary);
        }
        
        /* GAME STYLES */
        .compound-card {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: grab;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 2px solid white;
        }
        
        .compound-card:hover {
            transform: scale(1.1);
            z-index: 5;
        }
        
        .compound-symbol {
            font-size: 1.5rem;
            font-weight: 800;
        }
        
        .compound-name {
            font-size: 0.6rem;
            margin-top: 2px;
            text-align: center;
            padding: 0 2px;
        }
        
        .drop-zone {
            min-height: 120px;
            border: 3px dashed #cbd5e1;
            border-radius: 16px;
            background-color: #f8fafc;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
        }
        
        .drop-zone.active {
            border-color: #10b981;
            background-color: #d1fae5;
        }
        
        .test-result {
            min-height: 180px;
            border-radius: 16px;
            background-color: #fef3c7;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 20px;
            text-align: center;
        }
        
        .compound-formula {
            font-size: 2rem;
            font-weight: 800;
            color: #92400e;
            margin: 5px 0;
        }
        
        .compound-name-result {
            font-size: 1.2rem;
            font-weight: 700;
            color: #92400e;
        }
        
        .compound-description {
            font-size: 0.85rem;
            color: #57534e;
        }
        
        /* INDICATOR COLORS */
        .acid-card { 
            background: linear-gradient(135deg, #fecaca 0%, #f87171 100%);
            color: #7f1d1d;
        }
        
        .base-card { 
            background: linear-gradient(135deg, #bfdbfe 0%, #60a5fa 100%);
            color: #1e3a8a;
        }
        
        .neutral-card { 
            background: linear-gradient(135deg, #e5e7eb 0%, #9ca3af 100%);
            color: #374151;
        }
        
        .indicator-card { 
            background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%);
            color: #92400e;
            border: 2px dashed #f59e0b;
        }
        
        /* LITMUS PAPER STYLES */
        .litmus-paper {
            width: 80px;
            height: 120px;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.5s ease;
            margin: 10px auto;
        }
        
        .litmus-blue {
            background: linear-gradient(to bottom, #3b82f6 0%, #1d4ed8 100%);
        }
        
        .litmus-red {
            background: linear-gradient(to bottom, #ef4444 0%, #b91c1c 100%);
        }
        
        .litmus-purple {
            background: linear-gradient(to bottom, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .litmus-result {
            font-size: 1.5rem;
            font-weight: 800;
            margin: 10px 0;
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .result-acid {
            background-color: #fef2f2;
            color: #dc2626;
            border: 2px solid #fecaca;
        }
        
        .result-base {
            background-color: #eff6ff;
            color: #2563eb;
            border: 2px solid #bfdbfe;
        }
        
        .result-neutral {
            background-color: #f9fafb;
            color: #4b5563;
            border: 2px solid #e5e7eb;
        }
        
        /* BUTTON STYLES */
        .game-button {
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .game-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .game-button:active {
            transform: translateY(-1px);
        }
        
        .test-btn {
            background-color: #10b981;
            color: white;
        }
        
        .reset-btn {
            background-color: #ef4444;
            color: white;
        }
        
        .hint-btn {
            background-color: #f59e0b;
            color: white;
        }
        
        /* GAME INFO */
        .game-info-card {
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid;
        }
        
        .score-display {
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            color: #10b981;
            text-shadow: 2px 2px 0 #d1fae5;
        }
        
        .level-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            background-color: #fef3c7;
            color: #92400e;
        }
        
        /* ANIMATIONS */
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes newElement {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes colorChange {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .success-animation {
            animation: successPulse 0.5s ease 3;
        }
        
        .new-element {
            animation: newElement 0.3s ease-out;
        }
        
        .color-change {
            animation: colorChange 1s ease;
        }
        
        /* ACHIEVEMENT BADGES */
        .achievement-badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .app-logo {
            display: flex;
            align-items: center;
        }
        
        .app-logo-icon {
            background: #9999ff;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }
        
        .app-name {
            font-weight: 700;
            font-size: 1.25rem;
            color: #9999ff;
        }
        
        /* pH SCALE */
        .ph-scale {
            display: flex;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .ph-segment {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }
        
        .ph-marker {
            position: absolute;
            top: -10px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            transform: translateX(-50%);
            transition: left 1s ease;
        }
        /* Style untuk mobile consistency */
        @media (max-width: 414px) {
            .bottom-nav {
                height: 65px;
            }
            
            .nav-icon {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile App Container -->
    <div class="app-container">
        <!-- App Header -->
        <header class="bg-gradient-to-r from-primary to-secondary p-4 text-white">
            <div class="flex justify-between items-center">
                <div class="app-logo">
                    <div class="app-logo-icon">
                        <i class="fas fa-vial"></i>
                    </div>
                    <h1 class="app-name">QUANTARA</h1>
                </div>
                <div class="flex items-center space-x-3">
                    <i class="fas fa-search"></i>
                    <i class="fas fa-user-circle text-xl"></i>
                </div>
            </div>
        </header>
        
        <!-- Main Game Content -->
        <main class="pb-24 p-4">
            <!-- Game Title and Info -->
            <div class="mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-vial text-red-500 mr-2"></i> Game Lakmus: Asam, Basa & Netral
                </h1>
                <p class="text-gray-600">
                    Uji sifat senyawa kimia dengan lakmus! Tarik senyawa ke kertas lakmus untuk melihat reaksinya.
                </p>
            </div>
            
            <!-- Game Stats -->
            <div class="grid grid-cols-3 gap-3 mb-6">
                <div class="bg-blue-50 p-3 rounded-xl text-center border border-blue-100">
                    <div class="text-2xl font-bold text-blue-600" id="score">0</div>
                    <div class="text-xs text-blue-800">POIN</div>
                </div>
                <div class="bg-green-50 p-3 rounded-xl text-center border border-green-100">
                    <div class="text-2xl font-bold text-green-600" id="level">1</div>
                    <div class="text-xs text-green-800">LEVEL</div>
                </div>
                <div class="bg-purple-50 p-3 rounded-xl text-center border border-purple-100">
                    <div class="text-2xl font-bold text-purple-600" id="tests">0</div>
                    <div class="text-xs text-purple-800">PENGUJIAN</div>
                </div>
            </div>
            
            <!-- pH Scale -->
            <div class="mb-6">
                <h3 class="font-bold text-gray-700 mb-2 flex items-center">
                    <i class="fas fa-ruler text-purple-500 mr-2"></i> Skala pH
                </h3>
                <div class="ph-scale relative">
                    <div class="ph-segment" style="background-color: #dc2626;">Asam Kuat</div>
                    <div class="ph-segment" style="background-color: #ef4444;">Asam Lemah</div>
                    <div class="ph-segment" style="background-color: #f97316;">Asam Sangat Lemah</div>
                    <div class="ph-segment" style="background-color: #6b7280;">Netral</div>
                    <div class="ph-segment" style="background-color: #22d3ee;">Basa Sangat Lemah</div>
                    <div class="ph-segment" style="background-color: #3b82f6;">Basa Lemah</div>
                    <div class="ph-segment" style="background-color: #1d4ed8;">Basa Kuat</div>
                    <div class="ph-marker" id="ph-marker" style="left: 50%;"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-600 mt-1">
                    <span>pH 0-2</span>
                    <span>pH 3-6</span>
                    <span>pH 6</span>
                    <span>pH 7</span>
                    <span>pH 8</span>
                    <span>pH 9-11</span>
                    <span>pH 12-14</span>
                </div>
            </div>
            
            <!-- Current Objective -->
            <div class="game-info-card bg-amber-50 border-l-amber-400 mb-6">
                <div class="flex items-start">
                    <i class="fas fa-bullseye text-amber-500 mt-1 mr-3"></i>
                    <div>
                        <h3 class="font-bold text-amber-800">Tantangan Level <span id="current-level">1</span></h3>
                        <p id="objective" class="text-sm text-amber-700">
                            Identifikasi 3 senyawa asam dengan lakmus merah
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Litmus Paper Test Area -->
            <div class="mb-6">
                <h3 class="font-bold text-gray-700 mb-2 flex items-center">
                    <i class="fas fa-vial text-red-500 mr-2"></i> Area Pengujian Lakmus
                </h3>
                <div class="flex flex-col items-center mb-4">
                    <div class="text-sm text-gray-600 mb-2">Kertas Lakmus Biru</div>
                    <div id="litmus-blue" class="litmus-paper litmus-blue"></div>
                    <div class="text-sm text-gray-600 mt-4 mb-2">Kertas Lakmus Merah</div>
                    <div id="litmus-red" class="litmus-paper litmus-red"></div>
                </div>
                
                <div id="drop-zone" class="drop-zone mb-4">
                    <div class="text-gray-500" id="drop-hint">
                        Tarik senyawa ke salah satu kertas lakmus
                    </div>
                </div>
                
                <div class="text-center">
                    <button id="reset-test-btn" class="game-button reset-btn py-3 px-6">
                        <i class="fas fa-redo mr-2"></i> RESET LAKMUS
                    </button>
                </div>
            </div>
            
            <!-- Test Result -->
            <div class="mb-8">
                <h3 class="font-bold text-gray-700 mb-2 flex items-center">
                    <i class="fas fa-clipboard-check text-green-500 mr-2"></i> Hasil Pengujian
                </h3>
                <div id="test-result" class="test-result">
                    <div class="text-gray-500" id="result-placeholder">
                        Hasil pengujian akan muncul di sini
                    </div>
                    <div id="result-content" class="hidden">
                        <div class="compound-formula" id="compound-formula">HCl</div>
                        <div class="compound-name-result" id="compound-name">Asam Klorida</div>
                        <div class="litmus-result result-acid" id="litmus-result">ASAM</div>
                        <div class="compound-description" id="compound-description">
                            Lakmus biru berubah menjadi merah, lakmus merah tetap merah.
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Available Compounds -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-gray-700 flex items-center">
                        <i class="fas fa-flask text-blue-500 mr-2"></i> Senyawa Tersedia
                    </h3>
                    <div class="text-xs text-gray-500">
                        <span id="selected-count">0</span> dipilih
                    </div>
                </div>
                
                <div class="grid grid-cols-4 gap-3" id="compounds-container">
                    <!-- Compounds will be dynamically added here -->
                </div>
            </div>
            
            <!-- Achievements -->
            <div class="mb-8">
                <h3 class="font-bold text-gray-700 mb-3 flex items-center">
                    <i class="fas fa-trophy text-yellow-500 mr-2"></i> Pencapaian
                </h3>
                <div class="flex justify-around">
                    <div class="achievement-badge bg-yellow-100 text-yellow-600" id="ach1">
                        <i class="fas fa-flask"></i>
                    </div>
                    <div class="achievement-badge bg-gray-100 text-gray-400" id="ach2">
                        <i class="fas fa-vial"></i>
                    </div>
                    <div class="achievement-badge bg-gray-100 text-gray-400" id="ach3">
                        <i class="fas fa-atom"></i>
                    </div>
                    <div class="achievement-badge bg-gray-100 text-gray-400" id="ach4">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <a href="../dashboard siswa.html" class="nav-item">
        <i class="fas fa-home nav-icon"></i>
        <span>Beranda</span>
      </a>
      <a href="../soal harian/dashboard soal.html" class="nav-item">
        <i class="fas fa-flask nav-icon"></i>
        <span>Soal Harian</span>
      </a>
      <a href="../ai/nayra.html" class="nav-item">
        <i class="fas fa-robot nav-icon"></i>
        <span>Nayra AI</span>
      </a>
      <a href="../materi harian/kategori materi.html" class="nav-item">
        <i class="fas fa-chalkboard-teacher nav-icon"></i>
        <span>Materi Harian</span>
      </a>
      <a href="../profil/profil.html" class="nav-item">
        <i class="fas fa-user nav-icon"></i>
        <span>Profil</span>
      </a>
    </nav>
    </div>

    <script>
        // Game Data - Senyawa Asam, Basa, dan Netral
        const compounds = [
            // Asam
            { formula: "HCl", name: "Asam Klorida", type: "acid", strength: "strong", 
              description: "Asam kuat, lakmus biru menjadi merah, lakmus merah tetap merah.", 
              points: 15, pH: 1 },
            { formula: "H₂SO₄", name: "Asam Sulfat", type: "acid", strength: "strong",
              description: "Asam kuat, lakmus biru menjadi merah, lakmus merah tetap merah.",
              points: 15, pH: 1 },
            { formula: "HNO₃", name: "Asam Nitrat", type: "acid", strength: "strong",
              description: "Asam kuat, lakmus biru menjadi merah, lakmus merah tetap merah.",
              points: 15, pH: 2 },
            { formula: "CH₃COOH", name: "Asam Asetat", type: "acid", strength: "weak",
              description: "Asam lemah (cuka), lakmus biru menjadi merah, lakmus merah tetap merah.",
              points: 12, pH: 3 },
            { formula: "H₃PO₄", name: "Asam Fosfat", type: "acid", strength: "weak",
              description: "Asam lemah, lakmus biru menjadi merah, lakmus merah tetap merah.",
              points: 12, pH: 3 },
            { formula: "H₂CO₃", name: "Asam Karbonat", type: "acid", strength: "weak",
              description: "Asam lemah (dalam minuman berkarbonasi), lakmus biru menjadi merah.",
              points: 10, pH: 5 },
            
            // Basa
            { formula: "NaOH", name: "Natrium Hidroksida", type: "base", strength: "strong",
              description: "Basa kuat (soda api), lakmus merah menjadi biru, lakmus biru tetap biru.",
              points: 15, pH: 14 },
            { formula: "KOH", name: "Kalium Hidroksida", type: "base", strength: "strong",
              description: "Basa kuat, lakmus merah menjadi biru, lakmus biru tetap biru.",
              points: 15, pH: 14 },
            { formula: "Ca(OH)₂", name: "Kalsium Hidroksida", type: "base", strength: "strong",
              description: "Basa kuat (air kapur), lakmus merah menjadi biru, lakmus biru tetap biru.",
              points: 15, pH: 12 },
            { formula: "NH₃", name: "Amonia", type: "base", strength: "weak",
              description: "Basa lemah, lakmus merah menjadi biru, lakmus biru tetap biru.",
              points: 12, pH: 11 },
            { formula: "NaHCO₃", name: "Natrium Bikarbonat", type: "base", strength: "weak",
              description: "Basa lemah (baking soda), lakmus merah menjadi biru.",
              points: 10, pH: 9 },
            { formula: "Mg(OH)₂", name: "Magnesium Hidroksida", type: "base", strength: "weak",
              description: "Basa lemah (susu magnesia), lakmus merah menjadi biru.",
              points: 10, pH: 10 },
            
            // Netral
            { formula: "H₂O", name: "Air", type: "neutral", strength: "neutral",
              description: "Netral, tidak mengubah warna lakmus biru maupun merah.",
              points: 10, pH: 7 },
            { formula: "NaCl", name: "Garam Dapur", type: "neutral", strength: "neutral",
              description: "Netral (garam), tidak mengubah warna lakmus.",
              points: 10, pH: 7 },
            { formula: "C₆H₁₂O₆", name: "Glukosa", type: "neutral", strength: "neutral",
              description: "Netral (gula), tidak mengubah warna lakmus.",
              points: 10, pH: 7 },
            { formula: "C₂H₅OH", name: "Etanol", type: "neutral", strength: "neutral",
              description: "Netral (alkohol), tidak mengubah warna lakmus.",
              points: 10, pH: 7 }
        ];

        // Game Levels
        const levels = [
            { level: 1, objective: "Identifikasi 3 senyawa asam dengan lakmus merah", target: "acid", count: 3 },
            { level: 2, objective: "Identifikasi 3 senyawa basa dengan lakmus biru", target: "base", count: 3 },
            { level: 3, objective: "Identifikasi 2 senyawa netral", target: "neutral", count: 2 },
            { level: 4, objective: "Identifikasi senyawa asam kuat dan basa kuat", target: "both", count: 2 },
            { level: 5, objective: "Identifikasi semua jenis senyawa (asam, basa, netral)", target: "all", count: 5 }
        ];

        // Game State
        let gameState = {
            score: 0,
            level: 1,
            tests: 0,
            currentObjective: levels[0],
            achievements: [true, false, false, false],
            progress: { acid: 0, base: 0, neutral: 0 },
            selectedCompound: null,
            litmusState: { blue: "blue", red: "red" } // blue, red, purple
        };

        // DOM Elements
        const compoundsContainer = document.getElementById('compounds-container');
        const dropZone = document.getElementById('drop-zone');
        const resetTestBtn = document.getElementById('reset-test-btn');
        const testResult = document.getElementById('test-result');
        const resultPlaceholder = document.getElementById('result-placeholder');
        const resultContent = document.getElementById('result-content');
        const scoreDisplay = document.getElementById('score');
        const levelDisplay = document.getElementById('level');
        const testsDisplay = document.getElementById('tests');
        const currentLevelDisplay = document.getElementById('current-level');
        const objectiveDisplay = document.getElementById('objective');
        const selectedCountDisplay = document.getElementById('selected-count');
        const compoundFormula = document.getElementById('compound-formula');
        const compoundName = document.getElementById('compound-name');
        const compoundDescription = document.getElementById('compound-description');
        const litmusResult = document.getElementById('litmus-result');
        const litmusBlue = document.getElementById('litmus-blue');
        const litmusRed = document.getElementById('litmus-red');
        const phMarker = document.getElementById('ph-marker');

        // Initialize Game
        function initGame() {
            renderCompounds();
            updateGameStats();
            updateObjective();
            setupEventListeners();
            updateAchievements();
            updatePHMarker(7);
        }

        // Render Compounds
        function renderCompounds() {
            compoundsContainer.innerHTML = '';
            
            // Show compounds for current level
            const availableCompounds = getCompoundsForLevel();
            
            availableCompounds.forEach(compound => {
                const compoundDiv = document.createElement('div');
                compoundDiv.className = `compound-card new-element ${
                    compound.type === 'acid' ? 'acid-card' : 
                    compound.type === 'base' ? 'base-card' : 'neutral-card'
                }`;
                compoundDiv.dataset.formula = compound.formula;
                compoundDiv.dataset.type = compound.type;
                compoundDiv.innerHTML = `
                    <div class="compound-symbol">${compound.formula}</div>
                    <div class="compound-name">${compound.name}</div>
                `;
                
                // Make compound draggable
                compoundDiv.draggable = true;
                compoundDiv.addEventListener('dragstart', handleDragStart);
                compoundDiv.addEventListener('click', () => selectCompound(compound.formula));
                
                compoundsContainer.appendChild(compoundDiv);
            });
        }

        // Get compounds for current level
        function getCompoundsForLevel() {
            let availableCompounds = [];
            
            // Based on level, show different compounds
            if (gameState.level === 1) {
                // Level 1: Mostly acids
                availableCompounds = compounds.filter(c => c.type === 'acid');
                // Add one neutral as distractor
                availableCompounds.push(...compounds.filter(c => c.type === 'neutral').slice(0, 1));
            } else if (gameState.level === 2) {
                // Level 2: Mostly bases
                availableCompounds = compounds.filter(c => c.type === 'base');
                // Add one acid as distractor
                availableCompounds.push(...compounds.filter(c => c.type === 'acid').slice(0, 1));
            } else if (gameState.level === 3) {
                // Level 3: Mix with emphasis on neutral
                availableCompounds = compounds.filter(c => c.type === 'neutral');
                // Add some acids and bases
                availableCompounds.push(...compounds.filter(c => c.type === 'acid').slice(0, 2));
                availableCompounds.push(...compounds.filter(c => c.type === 'base').slice(0, 2));
            } else {
                // Level 4+: Mix of all
                availableCompounds = [...compounds];
            }
            
            // Shuffle and limit to 8 compounds
            return availableCompounds.sort(() => 0.5 - Math.random()).slice(0, 8);
        }

        // Drag and Drop Functions
        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.formula);
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            if (e.target.id === 'litmus-blue' || e.target.id === 'litmus-red') {
                e.target.style.transform = 'scale(1.05)';
            }
        }

        function handleDragLeave(e) {
            if (e.target.id === 'litmus-blue' || e.target.id === 'litmus-red') {
                e.target.style.transform = 'scale(1)';
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            
            const formula = e.dataTransfer.getData('text/plain');
            const compound = compounds.find(c => c.formula === formula);
            
            if (!compound) return;
            
            // Reset litmus paper scaling
            litmusBlue.style.transform = 'scale(1)';
            litmusRed.style.transform = 'scale(1)';
            
            // Determine which litmus paper was dropped on
            let litmusType = '';
            if (e.target.id === 'litmus-blue' || litmusBlue.contains(e.target)) {
                litmusType = 'blue';
            } else if (e.target.id === 'litmus-red' || litmusRed.contains(e.target)) {
                litmusType = 'red';
            } else {
                return; // Not dropped on litmus paper
            }
            
            // Test the compound on litmus paper
            testCompoundOnLitmus(compound, litmusType);
        }

        // Test compound on litmus paper
        function testCompoundOnLitmus(compound, litmusType) {
            gameState.selectedCompound = compound;
            gameState.tests += 1;
            
            // Determine color change based on compound type and litmus type
            let result = "";
            let litmusColor = "";
            
            if (compound.type === "acid") {
                result = "ASAM";
                litmusColor = "red"; // Acids turn blue litmus red, red litmus stays red
                if (litmusType === "blue") {
                    // Blue litmus turns red in acid
                    litmusBlue.className = "litmus-paper litmus-red color-change";
                    gameState.litmusState.blue = "red";
                }
                // Red litmus stays red in acid
                gameState.litmusState.red = "red";
                
                // Update progress
                gameState.progress.acid++;
            } 
            else if (compound.type === "base") {
                result = "BASA";
                litmusColor = "blue"; // Bases turn red litmus blue, blue litmus stays blue
                if (litmusType === "red") {
                    // Red litmus turns blue in base
                    litmusRed.className = "litmus-paper litmus-blue color-change";
                    gameState.litmusState.red = "blue";
                }
                // Blue litmus stays blue in base
                gameState.litmusState.blue = "blue";
                
                // Update progress
                gameState.progress.base++;
            } 
            else { // neutral
                result = "NETRAL";
                litmusColor = "purple"; // Neutral doesn't change litmus significantly
                // Litmus papers don't change color
                gameState.litmusState.blue = "blue";
                gameState.litmusState.red = "red";
                
                // Update progress
                gameState.progress.neutral++;
            }
            
            // Show result
            showTestResult(compound, result, litmusColor);
            
            // Update game stats
            updateGameStats();
            
            // Check level progress
            checkLevelProgress();
            
            // Update pH marker
            updatePHMarker(compound.pH);
        }

        // Show test result
        function showTestResult(compound, result, litmusColor) {
            resultPlaceholder.classList.add('hidden');
            resultContent.classList.remove('hidden');
            compoundFormula.textContent = compound.formula;
            compoundName.textContent = compound.name;
            compoundDescription.textContent = compound.description;
            
            // Set result styling
            litmusResult.textContent = result;
            litmusResult.className = "litmus-result";
            
            if (result === "ASAM") {
                litmusResult.classList.add("result-acid");
            } else if (result === "BASA") {
                litmusResult.classList.add("result-base");
            } else {
                litmusResult.classList.add("result-neutral");
            }
            
            // Add success animation
            testResult.classList.add('success-animation');
            
            // Remove animation class after animation completes
            setTimeout(() => {
                testResult.classList.remove('success-animation');
            }, 1500);
            
            // Add points
            gameState.score += compound.points;
            updateGameStats();
            
            // Show message
            showMessage(`Pengujian ${compound.name}: ${result}!`, "success");
        }

        // Update pH marker position
        function updatePHMarker(pH) {
            // Calculate position based on pH (0-14 scale)
            // pH scale is divided into 7 segments
            let position = 0;
            
            if (pH <= 2) {
                position = 7.14; // First segment (0-2)
            } else if (pH <= 6) {
                position = 21.43; // Second segment (3-6)
            } else if (pH < 7) {
                position = 35.71; // Third segment (6)
            } else if (pH === 7) {
                position = 50; // Fourth segment (7) - neutral
            } else if (pH === 8) {
                position = 64.29; // Fifth segment (8)
            } else if (pH <= 11) {
                position = 78.57; // Sixth segment (9-11)
            } else {
                position = 92.86; // Seventh segment (12-14)
            }
            
            phMarker.style.left = `${position}%`;
        }

        // Check level progress
        function checkLevelProgress() {
            const target = gameState.currentObjective.target;
            const requiredCount = gameState.currentObjective.count;
            let isComplete = false;
            
            if (target === "acid") {
                isComplete = gameState.progress.acid >= requiredCount;
            } else if (target === "base") {
                isComplete = gameState.progress.base >= requiredCount;
            } else if (target === "neutral") {
                isComplete = gameState.progress.neutral >= requiredCount;
            } else if (target === "both") {
                isComplete = gameState.progress.acid >= 1 && gameState.progress.base >= 1;
            } else if (target === "all") {
                isComplete = gameState.progress.acid >= 1 && gameState.progress.base >= 1 && gameState.progress.neutral >= 1;
            }
            
            if (isComplete) {
                setTimeout(() => {
                    levelUp();
                }, 1000);
            }
        }

        // Level Up
        function levelUp() {
            if (gameState.level < levels.length) {
                gameState.level += 1;
                gameState.currentObjective = levels[gameState.level - 1];
                // Reset progress for new level
                gameState.progress = { acid: 0, base: 0, neutral: 0 };
                
                updateObjective();
                updateGameStats();
                renderCompounds();
                resetLitmus();
                
                showMessage(`Level ${gameState.level} terbuka!`, "success");
                
                // Unlock achievement for completing level 2
                if (gameState.level >= 2 && !gameState.achievements[1]) {
                    gameState.achievements[1] = true;
                    unlockAchievement(1, "Ahli Lakmus");
                }
                
                // Unlock achievement for completing level 4
                if (gameState.level >= 4 && !gameState.achievements[2]) {
                    gameState.achievements[2] = true;
                    unlockAchievement(2, "Ahli Kimia");
                }
                
                // Unlock achievement for completing level 5
                if (gameState.level >= 5 && !gameState.achievements[3]) {
                    gameState.achievements[3] = true;
                    unlockAchievement(3, "Master Asam-Basa");
                }
            } else {
                showMessage("Selamat! Kamu telah menyelesaikan semua level!", "success");
            }
        }

        // Reset Litmus Papers
        function resetLitmus() {
            litmusBlue.className = "litmus-paper litmus-blue";
            litmusRed.className = "litmus-paper litmus-red";
            gameState.litmusState = { blue: "blue", red: "red" };
            updatePHMarker(7);
            
            // Clear result display
            resultPlaceholder.classList.remove('hidden');
            resultContent.classList.add('hidden');
        }

        // Select Compound
        function selectCompound(formula) {
            const compound = compounds.find(c => c.formula === formula);
            if (compound) {
                // Highlight the compound
                document.querySelectorAll('.compound-card').forEach(card => {
                    card.style.boxShadow = '';
                });
                
                const selectedCard = document.querySelector(`[data-formula="${formula}"]`);
                if (selectedCard) {
                    selectedCard.style.boxShadow = '0 0 0 3px #10b981';
                }
                
                // Show compound info in drop zone
                dropZone.innerHTML = `
                    <div class="text-center">
                        <div class="compound-symbol text-2xl mb-2">${compound.formula}</div>
                        <div class="font-bold">${compound.name}</div>
                        <div class="text-xs text-gray-600 mt-2">Seret ke kertas lakmus untuk menguji</div>
                    </div>
                `;
                
                gameState.selectedCompound = compound;
                selectedCountDisplay.textContent = "1";
            }
        }

        // Show Message
        function showMessage(message, type) {
            // Create message element
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-20 left-1/2 transform -translate-x-1/2 z-50 px-4 py-3 rounded-lg shadow-lg max-w-xs text-white font-bold ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            messageDiv.textContent = message;
            messageDiv.style.animation = 'fadeIn 0.3s ease-out';
            
            // Add to page
            document.body.appendChild(messageDiv);
            
            // Remove after 3 seconds
            setTimeout(() => {
                messageDiv.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 3000);
            
            // Add CSS for animation if not already present
            if (!document.querySelector('#message-animations')) {
                const style = document.createElement('style');
                style.id = 'message-animations';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translate(-50%, -20px); }
                        to { opacity: 1; transform: translate(-50%, 0); }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; transform: translate(-50%, 0); }
                        to { opacity: 0; transform: translate(-50%, -20px); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Update Game Stats Display
        function updateGameStats() {
            scoreDisplay.textContent = gameState.score;
            levelDisplay.textContent = gameState.level;
            testsDisplay.textContent = gameState.tests;
        }

        // Update Objective Display
        function updateObjective() {
            currentLevelDisplay.textContent = gameState.level;
            objectiveDisplay.textContent = gameState.currentObjective.objective;
        }

        // Update Achievements
        function updateAchievements() {
            const achievements = ['ach1', 'ach2', 'ach3', 'ach4'];
            achievements.forEach((achId, index) => {
                const badge = document.getElementById(achId);
                if (gameState.achievements[index]) {
                    badge.className = badge.className.replace('bg-gray-100 text-gray-400', 
                        index === 0 ? 'bg-yellow-100 text-yellow-600' :
                        index === 1 ? 'bg-orange-100 text-orange-600' :
                        index === 2 ? 'bg-blue-100 text-blue-600' :
                        'bg-purple-100 text-purple-600');
                }
            });
            
            // Unlock first achievement after first test
            if (gameState.tests >= 1 && !gameState.achievements[0]) {
                gameState.achievements[0] = true;
                unlockAchievement(0, "Percobaan Pertama");
            }
        }

        // Unlock Achievement
        function unlockAchievement(index, title) {
            showMessage(`Pencapaian terbuka: ${title}!`, "success");
            updateAchievements();
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Litmus paper drop events
            litmusBlue.addEventListener('dragover', handleDragOver);
            litmusBlue.addEventListener('dragleave', handleDragLeave);
            litmusBlue.addEventListener('drop', handleDrop);
            
            litmusRed.addEventListener('dragover', handleDragOver);
            litmusRed.addEventListener('dragleave', handleDragLeave);
            litmusRed.addEventListener('drop', handleDrop);
            
            // Button events
            resetTestBtn.addEventListener('click', resetLitmus);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'r' || e.key === 'R') {
                    resetLitmus();
                }
                if (e.key === 'Escape') {
                    dropZone.innerHTML = '<div class="text-gray-500" id="drop-hint">Tarik senyawa ke salah satu kertas lakmus</div>';
                    gameState.selectedCompound = null;
                    selectedCountDisplay.textContent = "0";
                }
            });
        }

        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
