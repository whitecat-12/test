<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Explorer - Aplikasi Belajar Fisika & Sains</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #38b2ac;  /* Keeping navbar primary color */
            --secondary: #0e7490; /* Keeping navbar secondary color */
            --accent: #f59e0b;
            --physics: #3b82f6;
            --chemistry: #10b981;
            --biology: #8b5cf6;
            --astronomy: #ec4899;
            --logo-color: #9999ff; /* Warna baru untuk logo */
        }
        
        body {
            font-family: 'Baloo 2', cursive;
            background-color: #f8fafc;
        }
        
        .app-container {
            max-width: 414px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* NAVBAR YANG SUDAH DISAMAKAN */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 414px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            background: white;
            z-index: 10;
            height: 70px; /* TINGGI SAMA */
            display: flex;
            align-items: center;
        }
        
        /* STYLE NAV ITEM YANG SAMA */
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            text-decoration: none;
            flex: 1;
            height: 100%;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
        }
        
        .nav-item span {
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-icon {
            transition: all 0.3s ease;
            font-size: 1.25rem; /* UKURAN SAMA */
        }
        
        .nav-icon.active {
            transform: translateY(-5px); /* EFEK SAMA */
            color: var(--primary);
        }
        
        .app-logo {
            display: flex;
            align-items: center;
        }
        
        .app-logo-icon {
            background: var(--logo-color); /* Warna diubah ke #9999ff */
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }
        
        .app-name {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--logo-color); /* Warna diubah ke #9999ff */
        }

        .floating-btn {
            animation: float 4s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .bounce {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        
        .islamic-pattern {
            background-image: radial-gradient(rgba(56, 178, 172, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .section-content {
            display: none;
            padding: 16px;
            background: white;
            border-radius: 12px;
            margin-top: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        
        .active-section {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .video-btn {
            transition: all 0.3s ease;
        }
        
        .video-btn:hover {
            transform: scale(1.1);
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .sticker {
            position: absolute;
            right: -10px;
            top: -10px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            transform: rotate(15deg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .achievement-badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .achievement-badge::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 50%;
            border: 2px dashed currentColor;
            opacity: 0.3;
            animation: spin 10s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* New styles for improved daily dose */
        .daily-dose-card {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            position: relative;
            border: none;
        }

        .daily-dose-header {
            background: linear-gradient(135deg, #3b82f6, #10b981);
            color: white;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .daily-dose-content {
            padding: 16px;
            position: relative;
        }

        .daily-dose-verse {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #334155;
            position: relative;
            padding-left: 24px;
            margin-bottom: 12px;
        }

        .daily-dose-verse::before {
            content: '"';
            position: absolute;
            left: 0;
            top: 0;
            font-size: 2rem;
            color: #38b2ac;
            line-height: 1;
        }

        .daily-dose-verse::after {
            content: '"';
            position: absolute;
            right: 0;
            bottom: -0.5em;
            font-size: 2rem;
            color: #38b2ac;
            line-height: 1;
        }

        .daily-dose-reference {
            display: block;
            text-align: right;
            font-style: italic;
            color: #64748b;
            margin-top: 8px;
        }

        .daily-dose-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 16px;
        }

        .daily-dose-button {
            flex: 1;
            margin: 0 4px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .daily-dose-button:hover {
            transform: translateY(-2px);
        }

        .daily-dose-button i {
            margin-right: 6px;
        }

        .daily-dose-progress {
            margin-top: 16px;
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .daily-dose-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .daily-dose-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.8rem;
            color: #64748b;
        }

        .daily-dose-calendar {
            position: absolute;
            top: -20px;
            right: 16px;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        .daily-dose-calendar-day {
            font-size: 1.5rem;
            font-weight: 700;
            color: #38b2ac;
            line-height: 1;
        }

        .daily-dose-calendar-month {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: #64748b;
            margin-top: 2px;
        }

        .daily-dose-hijri {
            position: absolute;
            bottom: -10px;
            right: 16px;
            background: #f59e0b;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .daily-dose-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .daily-dose-subtitle {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 12px;
        }

        .daily-dose-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e2e8f0, transparent);
            margin: 16px 0;
        }
        
        /* Quiz specific styles */
        .lavender-bg {
            background-color: #e6e6fa;
        }
        
        .lavender-border {
            border-color: #e6e6fa;
        }
        
        .lavender-text {
            color: #9370db;
        }
        
        .option:hover {
            background-color: #f3f4ff !important;
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
        
        .quiz-container {
            box-shadow: 0 10px 25px rgba(147, 112, 219, 0.15);
            border-radius: 16px;
        }
        
        .nav-button {
            transition: all 0.3s ease;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .option {
            transition: all 0.2s ease;
            border-radius: 12px;
            border: 2px solid #f1f1f1;
        }
        
        .correct-answer {
            background-color: #d4edda !important;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .wrong-answer {
            background-color: #f8d7da !important;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .score-display {
            background: linear-gradient(135deg, #e6e6fa 0%, #ffffff 100%);
            border-radius: 16px;
        }

        /* RESPONSIVE SAMA */
        @media (max-width: 414px) {
            .bottom-nav {
                height: 65px;
            }
            
            .nav-icon {
                font-size: 1.1rem;
            }
        }
    </style>

    <!-- 🔹 MathJax -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <!-- Mobile App Container -->
    <div class="app-container">
        <!-- App Header -->
        <header class="bg-gradient-to-r from-primary to-secondary p-4 text-white">
            <div class="flex justify-between items-center">
                <div class="app-logo">
                    <div class="app-logo-icon">
                        <i class="fas fa-atom"></i>
                    </div>
                    <h1 class="app-name">TETA SAINS</h1>
                </div>
                <div class="flex items-center space-x-3">
                    <i class="fas fa-search"></i>
                    <i class="fas fa-user-circle text-xl"></i>
                </div>
            </div>
        </header>
        
        <!-- Main Content Area -->
        <main class="pb-20 islamic-pattern">
            <!-- Quiz Container -->
            <div class="p-4">
                <div class="bg-white quiz-container p-4">
                    <!-- Header -->
                    <div class="text-center mb-6">
                        <h1 class="text-2xl font-bold lavender-text">Quiz Siswa</h1>
                        <div class="w-20 h-1 lavender-bg mx-auto mt-2 rounded-full"></div>
                        <p class="text-gray-600 mt-2 text-sm">Uji pengetahuanmu dengan quiz menyenangkan ini!</p>
                    </div>

                    <!-- Progress indicator -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium lavender-text">Progress</span>
                            <span class="text-sm font-medium text-gray-600" id="progress-text">1/10</span>
                        </div>
                        <div class="bg-gray-200 rounded-full h-2.5">
                            <div class="lavender-bg h-2.5 rounded-full" id="progress-bar" style="width: 10%"></div>
                        </div>
                    </div>

                    <!-- Tempat soal -->
                    <div id="quiz" class="space-y-6 mb-6"></div>

                    <!-- Navigasi soal -->
                    <div class="flex justify-between mt-6">
                        <button id="prevBtn" class="nav-button bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm" disabled>
                            ← Sebelumnya
                        </button>
                        <button id="nextBtn" class="nav-button lavender-bg text-white px-4 py-2 rounded-lg text-sm">
                            Selanjutnya →
                        </button>
                    </div>

                    <!-- Logout -->
                    <button id="logoutBtn" class="mt-6 w-full bg-white lavender-text border lavender-border p-3 rounded-lg font-medium hover:bg-lavender hover:text-white transition-all text-sm">
                        Logout
                    </button>
                </div>
            </div>
        </main>
        
        <!-- BOTTOM NAVIGATION YANG SUDAH DISAMAKAN -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home nav-icon"></i>
                <span>Beranda</span>
            </a>
            <a href="soal harian/dashboard soal.html" class="nav-item">
                <i class="fas fa-flask nav-icon"></i>
                <span>Soal Harian</span>
            </a>
            <a href="ai/index.html" class="nav-item">
                <i class="fas fa-robot nav-icon"></i>
                <span>Nayra AI</span>
            </a>
            <a href="kategori/kategori materi.html" class="nav-item">
                <i class="fas fa-chalkboard-teacher nav-icon"></i>
                <span>Materi Harian</span>
            </a>
            <a href="profil.html" class="nav-item">
                <i class="fas fa-user nav-icon"></i>
                <span>Profil</span>
            </a>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAJ5I8k2MzAyDLt9fUcXHRNtRVjKB_ETLY",
            authDomain: "projectid-81104.firebaseapp.com",
            projectId: "projectid-81104",
            storageBucket: "projectid-81104.firebasestorage.app",
            messagingSenderId: "554913260457",
            appId: "1:554913260457:web:bf988867ebfd902c651ab8",
            measurementId: "G-8WFHQW5WGN"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth();

        const quizEl = document.getElementById("quiz");
        const nextBtn = document.getElementById("nextBtn");
        const prevBtn = document.getElementById("prevBtn");
        const logoutBtn = document.getElementById("logoutBtn");
        const progressBar = document.getElementById("progress-bar");
        const progressText = document.getElementById("progress-text");

        let soalList = [];
        let currentIndex = 0;
        let score = 0;                 
        let answered = {};             
        let currentUser = null;

        // 🔹 Logout
        logoutBtn.addEventListener("click", async () => {
            await signOut(auth);
            window.location.href = "login.html";
        });

        // 🔹 Cek login user
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = "login.html";
            } else {
                currentUser = user;
                loadSoal();
            }
        });

        // 🔹 Ambil soal dari Firestore
        async function loadSoal() {
            try {
                const snapshot = await getDocs(collection(db, "soal"));
                soalList = snapshot.docs.map(doc => doc.data());

                if (soalList.length === 0) {
                    quizEl.innerHTML = `
                        <div class="text-center py-8">
                            <div class="text-5xl mb-4">📝</div>
                            <p class="text-gray-500">Belum ada soal yang tersedia.</p>
                        </div>`;
                } else {
                    updateProgress();
                    renderSoal();
                }
            } catch (err) {
                console.error("Error load soal:", err);
                quizEl.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-5xl mb-4 text-red-500">❌</div>
                        <p class="text-red-500">Gagal mengambil soal. Cek rules Firestore & login user.</p>
                    </div>`;
            }
        }

        // Update progress bar
        function updateProgress() {
            const progress = ((currentIndex + 1) / soalList.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${currentIndex + 1}/${soalList.length}`;
        }

        // 🔹 Tampilkan soal
        function renderSoal() {
            const data = soalList[currentIndex];
            updateProgress();

            quizEl.innerHTML = `
                <div class="p-4 bg-white border border-gray-100 rounded-xl shadow-sm">
                    <h2 class="font-semibold text-base mb-3 lavender-text">Soal ${currentIndex + 1}:</h2>
                    <p class="mb-4 text-gray-700 text-base">${data.pertanyaan}</p>
                    <div class="space-y-3">
                        ${["A","B","C","D"].map(opt => `
                            <div class="option bg-white p-3 rounded-lg cursor-pointer shadow-sm hover:shadow-md text-sm"
                                data-opt="${opt}" data-correct="${opt === data.jawaban}">
                                <span class="font-medium mr-2">${opt}.</span> ${data.opsi[opt]}
                            </div>
                        `).join("")}
                    </div>
                    <p id="feedback" class="mt-4 p-3 rounded-lg hidden text-sm"></p>
                </div>
            `;

            if (window.MathJax) MathJax.typesetPromise();

            document.querySelectorAll(".option").forEach(optEl => {
                optEl.addEventListener("click", () => {
                    const opt = optEl.dataset.opt;
                    const benar = optEl.dataset.correct === "true";
                    const feedback = document.getElementById("feedback");
                    feedback.classList.remove("hidden");

                    if (!answered[currentIndex]) {   
                        answered[currentIndex] = opt;
                        if (benar) {
                            score += (100 / soalList.length);
                        }
                    }

                    if (benar) {
                        optEl.classList.add("correct-answer");
                        feedback.innerHTML = "✅ <span class='font-medium'>Jawaban Benar!</span> " + (data.penjelasan || "");
                        feedback.className = "mt-4 p-3 rounded-lg bg-green-50 text-green-700 border border-green-200 text-sm";
                    } else {
                        optEl.classList.add("wrong-answer");
                        // Tandai juga jawaban yang benar
                        document.querySelectorAll(".option").forEach(o => {
                            if (o.dataset.correct === "true") {
                                o.classList.add("correct-answer");
                            }
                        });
                        feedback.innerHTML = "❌ <span class='font-medium'>Jawaban Salah.</span> " + (data.penjelasan || "");
                        feedback.className = "mt-4 p-3 rounded-lg bg-red-50 text-red-700 border border-red-200 text-sm";
                    }

                    if (window.MathJax) MathJax.typesetPromise([feedback]);

                    document.querySelectorAll(".option").forEach(o => {
                        o.style.pointerEvents = "none";
                    });
                });
            });

            prevBtn.disabled = currentIndex === 0;
            nextBtn.textContent = currentIndex === soalList.length - 1 ? "Selesai 🎯" : "Selanjutnya →";
            nextBtn.className = currentIndex === soalList.length - 1 
                ? "nav-button bg-green-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-600" 
                : "nav-button lavender-bg text-white px-4 py-2 rounded-lg text-sm";
        }

        // 🔹 Navigasi soal
        nextBtn.addEventListener("click", () => {
            if (currentIndex < soalList.length - 1) {
                currentIndex++;
                renderSoal();
            } else {
                showResult();
            }
        });

        prevBtn.addEventListener("click", () => {
            if (currentIndex > 0) {
                currentIndex--;
                renderSoal();
            }
        });

        // 🔹 Tampilkan hasil & simpan ke Firestore
        async function showResult() {
            const finalScore = Math.round(score);
            
            // Sembunyikan progress bar
            document.querySelector(".mb-6").style.display = "none";
            
            quizEl.innerHTML = `
                <div class="score-display p-6 text-center border border-lavender rounded-xl">
                    <div class="text-4xl mb-3">🎉</div>
                    <h2 class="text-xl font-bold mb-2 lavender-text">Quiz Selesai!</h2>
                    <p class="text-base text-gray-600 mb-3">Kamu telah menyelesaikan semua soal</p>
                    <div class="inline-block bg-white rounded-full px-5 py-3 shadow-md">
                        <span class="text-gray-600 text-sm">Nilai akhir:</span>
                        <span class="text-2xl font-bold lavender-text"> ${finalScore}</span>
                        <span class="text-gray-400 text-sm">/100</span>
                    </div>
                </div>
            `;
            nextBtn.style.display = "none";
            prevBtn.style.display = "none";

            try {
                await addDoc(collection(db, "nilai"), {
                    uid: currentUser.uid,
                    email: currentUser.email,
                    score: finalScore,
                    createdAt: new Date()
                });
                console.log("Nilai tersimpan");
            } catch (err) {
                console.error("Gagal simpan nilai:", err);
            }
        }

        // INTERAKSI NAVBAR YANG SUDAH DISAMAKAN
        document.addEventListener('DOMContentLoaded', function() {
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    navItems.forEach(nav => {
                        nav.classList.remove('active');
                        nav.querySelector('.nav-icon').classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    this.querySelector('.nav-icon').classList.add('active');
                });
            });
        });
    </script>
</body>
</html>
